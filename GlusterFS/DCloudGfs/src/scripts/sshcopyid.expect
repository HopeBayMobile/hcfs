#!/usr/bin/expect -f

set timeout 5
set Host [lindex $argv 0]

spawn ssh-copy-id nii@$Host

while {$timeout ne 0} {
    expect {
      "Host key verification failed" {
	system "cat ~/.ssh/known_hosts|sed '/\$IP/d'>~/.ssh/known_hosts"
     }
     "assword:" {
	send "deltacloud\r"
    expect "~/.ssh/authorized_keys"
	exit
     }
     "yes/no" {
        send "yes\r"
     }
     timeout {
	exit
     }
     eof {
        exit
     }
  }
}
