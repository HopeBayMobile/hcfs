<!DOCTYPE html>
<html lang="zh-tw">
    <head>
        <!--Title-->

        <title>Delta Storage Gateway</title>

        <!--Metadata-->

        <meta http-equiv="Content-type" content="text/html; charset=utf-8" />

        <!--CSS-->
        <link rel="stylesheet" type="text/css" name="bootstrap" href="/static/css/bootstrap.css" />
        <link rel="stylesheet" type="text/css" name="bootstrap" href="
        /static/css/site.css" />
        <link rel="stylesheet/less" type="text/css" href="/static/css/site-dashboard.less">
        {% block stylesheet %}
        {% endblock stylesheet %}
        <style type="text/css">
            {% block css_style %}
            /* Give a quick and non-cross-browser friendly divider */
            {% endblock css_style %}
        </style>
        <script src="/static/js/less-1.3.0.min.js" type="text/javascript"></script>
        <script src="/static/js/jquery-1.7.min.js"></script>
        <script src="/static/js/bootstrap.js"></script>
        <script src="/static/js/jquery-ui-1.8.18.custom.min.js"></script>
        <script src="/static/js/jquery.statusbar.js"></script>
        <script src="/static/js/jquery.validate.min.js"></script>
        <script src="/static/js/hogan.js"></script>
        <script src="/static/js/plugins.js"></script>
        <script type="text/javascript">
            $(function(){
                {% if tab %}
                $("#site-tab li:has(a[href='\/dashboard\/{{tab}}\/'])").addClass('active');
                {% else %}
                $("#site-tab li:first").addClass('active');
                {% endif %}
                $('#site-tab li').append('<span></span>')

                function setIndicator(name, status){
                    if (status){
                        $('#'+name).addClass('work');
                    } else {
                        $('#'+name).removeClass('work');
                    }
                }

                // Update the indicator icons
                function update_indicator(){
                    $.get('/dashboard/indicator/', function(ctnt, stat, opts){
                        if (stat == 'success'){
                            var indic;
                            var data = JSON.parse(ctnt);
                            for (indic in data){
                                setIndicator(indic, data[indic]);
                            }
                        }
                    });
                    $.get('/dashboard/status/', function(ctnt, stat, opts){
                        if (stat == 'success'){
                            var data = JSON.parse(ctnt);
                            $("#basic-bandwidth .down").text(data.downlink_usage);
                            $("#basic-bandwidth .up").text(data.uplink_usage);
                        }
                    });
                }
                setInterval(update_indicator, 3000);

                $("body").on('click', ".msg-detail", function(){
                    $(this).toggleClass('active')
                    if ($(this).hasClass('active')){
                        $(this).parent('.msg-content').css('white-space', 'normal')
                    } else {
                        $(this).parent('.msg-content').css('white-space', 'nowrap');
                    }
                });

                $(".tab-btn").on('click', 'li', function(){
                    window.location = $(this).find('a').attr('href')
                })

                var bar = $.statusbar({
                    onClick:function(arg) //add onclick function
                    {
                        alert("Argument= "+arg);
                    }
                });

                var msg_template = Hogan.compile('{% templatetag openvariable %}#msgs{% templatetag closevariable %}<ul class="msg-block"><li class="msg-content error">{% templatetag openvariable %} msg {% templatetag closevariable %}<div class="msg-time">{% templatetag openvariable %} timestamp {% templatetag closevariable %}</div><div class="msg-detail"></div></li></ul>{% templatetag openvariable %}/msgs{% templatetag closevariable %}');

                $.get('/dashboard/syslog/', function(ctnt, success, opt){
                    var msgs = JSON.parse(ctnt)
                    $(msg_template.render({'msgs': msgs})).appendTo('.statusbar-content')
                });
            });
        </script>
        {% block javascript %}
        {% endblock javascript %}
    </head>

    <body>
    <div  class="site-container">
        <table>
        <tr class="site-header">
            <td>
                <div class="logo-box">
                </div>
                <div class="notify-box-group">
                    <div class="notify-box-row-NW">
                        <div id="snapshot_in_progress" class="notify-box img-snapshot {% if result_data.snapshot_in_progress %}work{% endif %}">
                        </div>
                        <div id="system_check" class="notify-box img-system {% if result_data.system_check %}work{% endif %}">
                        </div>
                        <div id="network_ok" class="notify-box img-network {% if result_data.network_ok %}work{% endif %}">
                        </div>
                        <div id="flush_inprogress" class="notify-box img-flush {% if result_data.flush_inprogress %}work{% endif %}">
                        </div>
                        <div id="dirtycache_nearfull" class="notify-box img-dirtycache {% if result_data.dirtycache_nearfull %}work{% endif %}">
                        </div>
                    </div>
                    <div class="notify-box-row-NE">
                        {{ user.username }}<a href="/logout"><img src="/static/img/dashboard/indicator_logout_icon.png" alt=""></a></p>
                    </div>
                    <div class="notify-box-row-SE">
                        <p id="basic-bandwidth">
                            Download / Upload:<br>
                            <span class="down">{{ result_data.downlink_usage }}</span> / <span class="up">{{ result_data.uplink_usage }}</span>
                            (KB/Sec)
                        </p>
                    </div>
                </div><!-- / -->
            </td>
        </tr>
        <tr class="site-body">
        <td>
        <div class="left-row left-bg">
            <div>
                <ul class="tab-btn" id="site-tab">
                  <li class=""><a href="{% url dashboard:index %}">Dashboard</a></li>
                  <!--<li class=""><a href="{% url dashboard:account action=None %}">Storage Account</a></li>-->
                  <li class=""><a href="{% url dashboard:system action=None %}">System Configurations</a></li>
                  <li class=""><a href="{% url dashboard:sharefolder action=None %}">Share Folder</a></li>
                  <li class=""><a href="{% url dashboard:sync %}">Sync</a></li>
                  <li class=""><a href="{% url dashboard:snapshot action=None %}">Snapshot</a></li>
                  <li class=""><a href="{% url dashboard:syslog %}">System Log</a></li>
                  <li class=""><a href="{% url dashboard:config action=None %}">Configuration</a></li>
                  <li class=""><a href="{% url dashboard:power action=None %}"><img src="/static/img/dashboard/power_icon.png"></a></li>
                </ul>
            </div>
        </div>
        <div id="errormsgbox"></div>
        <div class="main-row main-bg">
            <div class="main-content">
                <div class="main-content-spacer"></div>
                {% block tab_content %}
                {% endblock tab_content %}
            </div>

        </div>
        </td>
        </tr>
        </table> <!-- site-body --></div>
    </body>
</html>
