{% extends "dashboard/base.html" %}
{% block javascript %}
    <script type="text/javascript">

        toogle_progress = (function(target){
            var toogle_indicator = 1;
            function return_func(){
                var num = toogle_indicator % 2 + 1;
                $(target).attr("src", "/static/img/dashboard/in_progress_0" + num + ".png");
                toogle_indicator += 1;
            }
            return return_func
        })("#progress-light");

        $(function(){


            function toggle_selector(){
                var actived = $(".menu-button.select.active")
                if (!actived.length){
                    $("#bottom-popup").animate({"height": "0px"}, 1000);
                    $(".bottom-popup-spacer").hide();
                } else {
                    $("#bottom-popup").animate({"height": "63px"}, 1000);
                    $(".bottom-popup-spacer").show();
                }
                $("#snapshot-list tr > :nth-child(1)").fadeToggle(1000);
            }

            $("body").on("click", ".menu-button.select:not(.disabled)", function(){
                $("#bottom-popup #do-action").text($(this).text());
                $(this).toggleClass("active")
                $(".menu-button").not($(this)).toggleClass("disabled")
                toggle_selector();
            });
            setInterval(toogle_progress, 500);

            $("body").on("click", "#create:not(.disabled)", function(){
                $.post('/dashboard/snapshot/create', function(ctnt){
                    // Show alert message if necessary
                }).error(function(obj, stat, msg){
                    $("#create-popup").text(obj.responseText).fadeIn(500).delay(2000).fadeOut(500);
                }).complete(function(){
                    $.get("/dashboard/snapshot", function(data){
                        $("#snapshot-list tbody").html(data);
                    });
                });
            });

            $("body").on("click", "#select-cancel", function(){
                $(".menu-button").removeClass("active disabled")
                toggle_selector()
            });

            function get_snapshots(){
                var snapshots = [];
                $.each($(":checked"), function(idx, item){
                    snapshots.push(this.value)
                });
                return snapshots;
            }

            $("#bottom-popup #do-action").on("click", function(){
                $.post('/dashboard/snapshot/'+ $(this).text().toLowerCase(),
                       {"snapshots": get_snapshots()},
                       function(ctnt, success, opts){
                           console.log(ctnt);
                       });
            });

        });
    </script>
{% endblock javascript %}
{% block tab_content %}
    <ul class="nav nav-tabs">
        <li class="active"><a href="#snapshot" data-toggle="tab">Snapshot</a></li>
        <li class=""><a href="#schedule" data-toggle="tab">Schedule</a></li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane active" id="snapshot" style="">
            <div id="create-popup" class="hide"></div>
            <button id="create" class="menu-button ">Create</button>
            <button class="menu-button select">Delete</button>
            <button class="menu-button select">Export</button>
            <div id="" style="">
                <table id="snapshot-list" class="table table-striped table-bordered table-condensed">
                    <thead>
                      <tr>
                        <th class="span1 hide">#</th>
                        <th class="span2">Snapshot ID</th>
                        <th class="span1">Usage</th>
                        <th class="span2">Time</th>
                        <th style="width: 75px;">Status</th>
                        <th class="span1">Export</th>
                        <th class="span2">Path</th>
                      </tr>
                    </thead>
                    <tbody>
                    {% include "dashboard/snapshot_tbody.html" %}
                    </tbody>
                </table>
            </div>
            <div class="bottom-popup-spacer"></div>
        </div>
        <div class="tab-pane" id="schedule">
            This is the schedule view.
        </div>
    </div>
    <div id="bottom-popup">
        <button id="select-cancel">Cancel</button>
        <button id="do-action">Done</button>
    </div>
{% endblock tab_content %}
