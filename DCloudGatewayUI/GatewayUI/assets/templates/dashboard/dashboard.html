{% extends "dashboard/base.html" %}
{% block javascript %}
<script type="text/javascript">
	$(function(){
		$(".control .upgrade").on("click", function(){
			$.post("/dashboard/system_upgrade/", function(ctnt, status, opts){
				console.log(ctnt);
			})
		});

		function update_cache(){
	        $.get('/dashboard/cache_usage/', function(ctnt, stat, opts){
	            var data = JSON.parse(ctnt);
	            for (key in data){
	            	$('#'+key).find('span').text(data[key])
	            }
	            used_cache_percentage = Math.round(data['used_cache_size'] * 100 / data['max_cache_size']);
	            $(".cache-usage-bar .usage .used").css('background-size', used_cache_percentage + "% 100%");
				dirty_cache_percentage = Math.round(data['dirty_cache_size'] * 100 / data['max_cache_size']);
				$(".cache-usage-bar .usage .dirty").css('background-size', dirty_cache_percentage + "% 100%");
	        });
	    }
	    $("#http_proxy").on("click", function(e){
	    	var action = "off";
	    	if($(this).is(':checked')){
	    		action = "on"
	    	}
	    	$.post("/dashboard/http_proxy/" + action, function(ctnt, success, opts){
	    		console.log(ctnt);
    		});
	    })
	    setInterval(update_cache, 10000);
	});
</script>
{% endblock javascript %}
{% block tab_content %}

<div class="system-pane">
	<div class="status">
		<div class="header">System Status</div>
		<ul>
			<li><div id="HDD_ok" class="notify-box img-indicator {% if result_data.HDD_ok %}work{% endif %}">
	    		</div><span>HDD</span></li>
			<li><div id="NFS_srv" class="notify-box img-indicator {% if result_data.NFS_srv %}work{% endif %}">
			    </div><span>NFS</span></li>
			<li><div id="SMB_srv" class="notify-box img-indicator {% if result_data.SMB_srv %}work{% endif %}">
			    </div><span>SMB</span></li>
			<li><div id="HTTP_proxy_srv" class="notify-box img-indicator {% if result_data.HTTP_proxy_srv %}work{% endif %}">
			    </div><span>HTTP Proxy</span></li>
		</ul>
	</div>
	<div class="control">
		<div class="header">System Control
			<div class="upgrade {% if not available_version %}hide{% endif %}">New<br>Version</div>
		</div>
        <ul>
            <li><div class="control-box"><label for="http_proxy"><input type="checkbox" name="http_proxy" id="http_proxy" /><span class="toggle-btn"></span></label></div><span>Http Proxy</span></li>
        </ul>
	</div>
	<p style="clear:both;"></p>
</div>
<div class="cache-usage-bar">
	<div class="indicator">
		<div>
			<img src="/static/img/dashboard/1_capacity_icon_1.png" alt="">
			<p id="dirty_cache_size">Dirty cache: <span>{{gateway_cache_usage.dirty_cache_size}}</span>GB</p>
			<p id="dirty_cache_entries">Dirty entries: <span>{{gateway_cache_usage.dirty_cache_entries}}</span></p>
		</div>

		<div>
			<img src="/static/img/dashboard/1_capacity_icon_2.png" alt="">
			<p id="used_cache_size">Used cache: <span>{{gateway_cache_usage.used_cache_size}}</span>GB</p>
			<p id="used_cache_entries">Used entries: <span>{{gateway_cache_usage.used_cache_entries}}</span></p>
		</div>
		<div>
			<img src="/static/img/dashboard/1_capacity_icon_3.png" alt="">
			<p id="max_cache_size">Max cache: <span>{{gateway_cache_usage.max_cache_size}}</span>GB</p>
			<p id="max_cache_entries">Max entries: <span>{{gateway_cache_usage.max_cache_entries}}</span></p>
		</div>
	</div>
	<div class="usage">
		<div class="total"></div>
		<div class="used" style="background-size: {{used_cache_percentage}}% 100%"></div>
		<div class="dirty" style="background-size: {{dirty_cache_percentage}}% 100%"></div>
	</div>
</div>
{% endblock tab_content %}