{% extends "dashboard/base.html" %}
{% block javascript %}
<script type="text/javascript">
	$(function(){
		$(".control .upgrade").on("click", function(){
			$("#errormsgbox").hide()
			$("#delta-popup .popup-box.notify").show()
			$("#delta-popup").fadeIn(1000)
		});

		function update_dashboard(){
	        $.get('/dashboard/data_update/', function(ctnt, stat, opts){
	            var data = JSON.parse(ctnt);

	            if (data["version_upgrade"]){
	            	$(".control .upgrade").show();
	            }
	            var cache_data = data["gateway_cache_usage"]
	            for (key in cache_data){
	            	$('#'+key).find('span').text(cache_data[key])
	            }
	            used_cache_percentage = Math.round(cache_data['used_cache_size'] * 100 / cache_data['max_cache_size']);
	            $(".cache-usage-bar .usage .used").css('background-size', used_cache_percentage + "% 100%");
				dirty_cache_percentage = Math.round(cache_data['dirty_cache_size'] * 100 / cache_data['max_cache_size']);
				$(".cache-usage-bar .usage .dirty").css('background-size', dirty_cache_percentage + "% 100%");

				var cloud_data = data["cloud_storage_usage"]
				for (key in cloud_data){
					$('#'+key).find('span').text(cloud_data[key])
				}
	        });
	    }
	    $("#http_proxy").on("click", function(e){
	    	var action = "off";
	    	if($(this).is(':checked')){
	    		action = "on"
	    	}
	    	$.post("/dashboard/http_proxy/" + action, function(ctnt, success, opts){
	    		console.log(ctnt);
    		});
	    })
	    setInterval(update_dashboard, 10000);
	    $(".system-pane > .status div[rel=tooltip]").tooltip({"placement": "bottom"});
	});
</script>
{% endblock javascript %}
{% block tab_content %}

<div class="system-pane">
	<div class="status">
		<div class="header">System Status</div>
		<ul>
			<li><div id="HDD_ok" rel="tooltip" title="HDD" class="notify-box img-indicator {% if result_data.HDD_ok %}work{% endif %}">
	    		</div><span>HDD</span></li>
			<li><div id="NFS_srv" rel="tooltip" title="NFS Service" class="notify-box img-indicator {% if result_data.NFS_srv %}work{% endif %}">
			    </div><span>NFS</span></li>
			<li><div id="SMB_srv" rel="tooltip" title="SMB Service" class="notify-box img-indicator {% if result_data.SMB_srv %}work{% endif %}">
			    </div><span>SMB</span></li>
		</ul>
	</div>
	<div class="control">
		<div class="header">System Control
			<div class="upgrade hide">New<br>Version</div>
		</div>
        <ul>
            <li><div class="control-box"><label for="http_proxy"><input type="checkbox" name="http_proxy" id="http_proxy" /><span class="toggle-btn"></span></label></div><span>Http Proxy</span></li>
        </ul>
	</div>
	<p style="clear:both;"></p>
</div>
<div class="data-stored">
	<p id="cloud_data">Total amount of data stored: <span>{{ cloud_storage_usage.cloud_data }}</span> GB</p>
	<p id="cloud_data_dedup_compress">Actual amount of data stored: <span>{{ cloud_storage_usage.cloud_data_dedup_compress }}</span> GB</p>
</div>
<div class="cache-usage-bar">
	<div class="indicator">
		<div>
			<img src="/static/img/dashboard/1_capacity_icon_1.png" alt="">
			<p id="dirty_cache_size">Dirty cache: <span>{{gateway_cache_usage.dirty_cache_size}}</span>GB</p>
			<p id="dirty_cache_entries">Dirty entries: <span>{{gateway_cache_usage.dirty_cache_entries}}</span></p>
		</div>

		<div>
			<img src="/static/img/dashboard/1_capacity_icon_2.png" alt="">
			<p id="used_cache_size">Used cache: <span>{{gateway_cache_usage.used_cache_size}}</span>GB</p>
			<p id="used_cache_entries">Used entries: <span>{{gateway_cache_usage.used_cache_entries}}</span></p>
		</div>
		<div>
			<img src="/static/img/dashboard/1_capacity_icon_3.png" alt="">
			<p id="max_cache_size">Max cache: <span>{{gateway_cache_usage.max_cache_size}}</span>GB</p>
			<p id="max_cache_entries">Max entries: <span>{{gateway_cache_usage.max_cache_entries}}</span></p>
		</div>
	</div>
	<div class="usage">
		<div class="total"></div>
		<div class="used" style="background-size: {{used_cache_percentage}}% 100%"></div>
		<div class="dirty" style="background-size: {{dirty_cache_percentage}}% 100%"></div>
	</div>
</div>
{% endblock tab_content %}