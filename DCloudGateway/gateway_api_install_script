apt-get install -y --force-yes python-setuptools python-software-properties curl portmap nfs-kernel-server samba ntpdate chkconfig traceroute
apt-get install -y --force-yes python
add-apt-repository -y ppa:swift-core/release
apt-get update
apt-get install -y --force-yes swift
apt-get install -y --force-yes apt-show-versions
apt-get install -y --force-yes squid3
sudo dpkg -i ./sudo_1.8.5-2_amd64.deb

# install squid3 proxy
cd ./src/http_proxy/
python install_proxy.py
cd ..
cd ..
# add double check for squid3 cache directory at each power on.
CACHEDIR="/storage/http_proxy_cache/"
cat >/etc/init.d/make_http_proxy_cache_dir <<EOF
mkdir $CACHEDIR
chmod 777 $CACHEDIR
EOF
chmod 777 /etc/init.d/make_http_proxy_cache_dir
cp -rs /etc/init.d/make_http_proxy_cache_dir /etc/rc2.d/S29make_http_proxy_cache_dir
echo "    Squid3 configuration has been written."

# setup gateway api
python setup.py install

sudo ln -s /usr/lib/insserv/insserv /sbin/insserv
sudo chkconfig --level 2345 nfs-kernel-server off

