#!/bin/bash

CURPATH="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Install dependencies
packages="libattr1-dev"
packages="$packages gcovr"
packages_to_install=""
for P in $packages; do
	if ! dpkg -s "$P" >/dev/null 2>&1; then
		packages_to_install="$packages_to_install $P"
	fi
done
[ -n "$packages_to_install" ] && sudo apt-get install -y $packages_to_install

cd c/unittest_modules/utils/
rm *.gcda
rm *.gcov
rm *.gcno
make clean
make
./utils_unittest
cd $CURPATH
cd c/unittest_modules/meta_mem_cache/
rm *.gcda
rm *.gcov
rm *.gcno
make clean
make
./meta_mem_cache_unittest
cd $CURPATH
gcovr -r ../../src/HCFS/
