# A sample Makefile for building Google Test and using it in user
# tests.  Please tweak it to suit your environment and project.  You
# may want to move it to your project's root directory.
#
# SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

HCFS_ROOT ?= $(realpath ../../../../..)
mkfile_path := $(realpath $(lastword $(MAKEFILE_LIST)))
MD_PATH := $(realpath $(dir $(mkfile_path)))
USER_DIR := $(realpath $(dir $(mkfile_path))/unittests) \
  $(realpath $(HCFS_ROOT)/src/HCFS) \

include $(realpath $(HCFS_ROOT)/tests/unit_test/c/unittest_modules/common.mk)

$(eval $(call ADDMODULE))

# All tests produced by this Makefile.

$(eval BATCH_UT := 1)
$(eval $(call ADDTEST, fuseop_unittest, \
  fuseop.o \
  fake_meta_mem_cache.o \
  fake_misc.o \
  fuseop_unittest.o \
  meta.o ))
# Cleanup before test
$(MD_PATH)/obj/fuseop_unittest.pass: | /tmp/test_fuse
/tmp/test_fuse:
	@sudo fusermount -uz /tmp/test_fuse || :

$(eval $(call ADDTEST, do_fallocate_unittest, \
  do_fallocate.o \
  fake_meta_mem_cache.o \
  fake_misc_do_fallocate.o \
  do_fallocate_unittest.o ))
