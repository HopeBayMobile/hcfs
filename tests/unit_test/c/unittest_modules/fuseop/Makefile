# A sample Makefile for building Google Test and using it in user
# tests.  Please tweak it to suit your environment and project.  You
# may want to move it to your project's root directory.
#
# SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

HCFS_ROOT ?= $(realpath ../../../../..)
mkfile_path := $(realpath $(lastword $(MAKEFILE_LIST)))
MD_PATH := $(realpath $(dir $(mkfile_path)))
USER_DIR := $(realpath $(dir $(mkfile_path))/unittests) \
  $(realpath $(HCFS_ROOT)/src/HCFS) \

include $(realpath $(HCFS_ROOT)/tests/unit_test/c/unittest_modules/common.mk)

$(eval $(call ADDMODULE))

# All tests produced by this Makefile.

RERUN_TIMEOUT := 5
$(eval $(call ADDTEST, fuseop_unittest, \
  alias.o \
  fuseop.o \
  fake_meta_mem_cache.o \
  fake_apk_mgmt.o \
  fake_misc.o \
  fake_fuse_notify.o \
  fuseop_unittest.o \
  meta.o ))

$(eval $(call ADDTEST, do_fallocate_unittest, \
  do_fallocate.o \
  fake_meta_mem_cache.o \
  fake_misc_do_fallocate.o \
  do_fallocate_unittest.o ))

$(eval $(call ADDTEST, fuse_notify_unittest, \
  fuse_notify.o \
  fuse_notify_unittest.o \
  ut_helper.o ))
