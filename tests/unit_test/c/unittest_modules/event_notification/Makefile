# A sample Makefile for building Google Test and using it in user
# tests.  Please tweak it to suit your environment and project.  You
# may want to move it to your project's root directory.
#
# SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

# Please tweak the following variable definitions as needed by your
# project, except GTEST_HEADERS, which you can use in your own targets
# but shouldn't modify.

USER_DIR += $(realpath unittests)
include ../common.mk

# monitor unittest
$(eval $(call ADDTEST, event_filter_unittest, \
  event_filter_unittest.o event_filter.o))

$(eval $(call ADDTEST, event_notification_unittest, \
  event_notification_unittest.o event_notification.o mock_server.o))

# Load Generated test list
ifneq ($(MAKECMDGOALS),clean)
  -include $(OBJ_DIR)/*.tests
endif

test: $(RUN_TESTS) | $(UT_FILES)
ifndef GEN_TEST # Reload make rule if nothing is loaded
	make test
else
  ifndef NOGCOVR
	gcovr -p -k -r $(USER_DIR) .
  endif
endif

clean:
	rm -rf $(UT_FILES) *.gcda *.gcov $(OBJ_DIR) *.xml

# finalizing the default targets
all: setup $(UT_FILES)
